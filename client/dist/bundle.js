!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);let n=class{constructor(e,t,...o){const n=class e{static create(t,o,n){return new Proxy(t,{get:(t,r,a)=>e._ehFuncao(t[r])&&o.includes(r)?function(){console.log(`"${r}" disparou a armadilha`),t[r].apply(t,arguments),n(t)}:t[r],set(e,t,r,a){const i=Reflect.set(e,t,r);return o.includes(t)&&n(e),i}})}static _ehFuncao(e){return typeof e==typeof Function}}.create(e,o,e=>{t.update(e)});return t.update(e),n}};const r=["negociacoes"];let a=null,i=null;let s=(c=function*(){return new class{constructor(e){this._connection=e,this._store="negociacoes"}adiciona(e){return new Promise((t,o)=>{const n=this._connection.transaction([this._store],"readwrite").objectStore(this._store).add(e);n.onsuccess=e=>t(),n.onerror=e=>{console.log(e.target.error),o("Não foi possível salvar a negociação")}})}listaTodos(){return new Promise((e,t)=>{const o=[],n=this._connection.transaction([this._store],"readwrite").objectStore(this._store).openCursor();n.onsuccess=t=>{const n=t.target.result;if(n){const e=new m(n.value._data,n.value._quantidade,n.value._valor);o.push(e),n.continue()}else e(o)},n.onerror=e=>{console.log(e.target.error),t("Não foi possível listar nas negociações")}})}apagaTodos(){return new Promise((e,t)=>{const o=this._connection.transaction([this._store],"readwrite").objectStore(this._store).clear();o.onsuccess=t=>e(),o.onerror=e=>{console.log(e.target.error),t("Não foi possível apagar as negociações")}})}}(yield class e{constructor(){throw new Error("Não é possível criar instâncias dessa classe")}static getConnection(){return new Promise((t,o)=>{if(a)return t(a);const n=indexedDB.open("jscangaceiro",2);n.onupgradeneeded=t=>{e._createStores(t.target.result)},n.onsuccess=e=>{a=e.target.result,i=a.close.bind(a),a.close=()=>{throw new Error("Você não pode fechar diretamente a conexão")},t(e.target.result)},n.onerror=e=>{console.log(e.target.error),o(e.target.error.name)}})}static _createStores(e){r.forEach(t=>{e.objectStoreNames.contains(t)&&e.deleteObjectStore(t),e.createObjectStore(t,{autoIncrement:!0})})}static closeConnection(){a&&i()}}.getConnection())},u=function(){var e=c.apply(this,arguments);return new Promise((function(t,o){return function n(r,a){try{var i=e[r](a),s=i.value}catch(e){return void o(e)}if(!i.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));t(s)}("next")}))},function(){return u.apply(this,arguments)});var c,u;let l=class extends Error{constructor(e=""){super(e),this.name=this.constructor.name}};const d=l;function p(e){return function(e){return e instanceof d||Object.getPrototypeOf(e)instanceof d}(e)?e.message:(console.log(e),"Não foi possível realizar a operação.")}function h(e=500){return function(t,o,n){const r=n.value;let a=0;return n.value=function(...t){event&&event.preventDefault(),clearInterval(a),a=setTimeout(()=>r.apply(this,t),e)},n}}function f(e){throw new Error(`${e} é um parâmetro obrigatório`)}function g(e=f("event"),t=f("selector"),o=!0){return function(n,r,a){return Reflect.defineMetadata("bindEvent",{event:e,selector:t,prevent:o,propertyKey:r},Object.getPrototypeOf(n),r),a}}let m=class{constructor(e=f("data"),t=f("quantidade"),o=f("valor")){Object.assign(this,{_quantidade:t,_valor:o}),this._data=new Date(e.getTime()),Object.freeze(this)}get volume(){return this._quantidade*this._valor}get data(){return new Date(this._data.getTime())}get quantidade(){return this._quantidade}get valor(){return this._valor}equals(e){return JSON.stringify(this)==JSON.stringify(e)}};let v=class{constructor(e){this._elemento=document.querySelector(e)}update(e){this._elemento.innerHTML=this.template(e)}template(e){throw new Error("Você precisa implementar o método template")}},_=class extends v{template(e){return e.texto?`<p class="alert alert-info">${e.texto}</p>`:"<p></p>"}},y=class extends l{constructor(){super("A data deve estar no formato dd/mm/aaaa")}},w=class{constructor(){throw new Error("Esta classe não pode ser instanciada")}static paraTexto(e){return`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()}`}static paraData(e){if(!/\d{2}\/\d{2}\/\d{4}/.test(e))throw new y;return new Date(...e.split("/").reverse().map((e,t)=>e-t%2))}},b=class extends v{template(e){return`\n        <table class="table table-hover table-bordered">\n            <thead>\n                <tr>\n                    <th>DATA</th>\n                    <th>QUANTIDADE</th>\n                    <th>VALOR</th>\n                    <th>VOLUME</th>\n                </tr>\n            </thead>\n            \n            <tbody>\n                ${e.paraArray().map(e=>`\n                    <tr>\n                        <td>${w.paraTexto(e.data)}</td>\n                        <td>${e.quantidade}</td>\n                        <td>${e.valor}</td>\n                        <td>${e.volume}</td>\n                    </tr>                        \n                `).join("")}\n            </tbody>\n            \n            <tfoot>\n                <tr>\n                    <td colspan="3"></td>\n                    <td>${e.volumeTotal}</td>            \n                </tr>\n            </tfoot>\n            \n        </table>               \n        `}};var x,O,D,N,j,P,S,E;function T(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,o){return function n(r,a){try{var i=t[r](a),s=i.value}catch(e){return void o(e)}if(!i.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}function q(e,t,o,n,r){var a={};return Object.keys(n).forEach((function(e){a[e]=n[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=o.slice().reverse().reduce((function(o,n){return n(e,t,o)||o}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}new(x=function(...e){const t=e.map(e=>document.querySelector(e));return function(e){const o=e,n=function(){const e=new o(...t);Object.getOwnPropertyNames(o.prototype).forEach(t=>{Reflect.hasMetadata("bindEvent",e,t)&&function(e,t){document.querySelector(t.selector).addEventListener(t.event,o=>{t.prevent&&o.preventDefault(),e[t.propertyKey](o)})}(e,Reflect.getMetadata("bindEvent",e,t))})};return n.prototype=o.prototype,n}}("#data","#quantidade","#valor"),O=g("submit",".form"),D=h(),N=g("click","#botao-importa"),j=h(),P=g("click","#botao-apaga"),x((q((E=class{constructor(e,t,o){Object.assign(this,{_inputData:e,_inputQuantidade:t,_inputValor:o}),this._negociacoes=new n(new class{constructor(){this._negociacoes=[],Object.freeze(this)}adiciona(e){this._negociacoes.push(e)}paraArray(){return[].concat(this._negociacoes)}get volumeTotal(){return this._negociacoes.reduce((e,t)=>e+t.volume,0)}esvazia(){this._negociacoes.length=0}},new b("#negociacoes"),"adiciona","esvazia"),this._mensagem=new n(new class{constructor(e=""){this._texto=e}get texto(){return this._texto}set texto(e){this._texto=e}},new _("#mensagemView"),"texto"),this._service=new class{constructor(){this._http=new class{_handleErrors(e){if(!e.ok)throw new Error(e.statusText);return e}get(e){return fetch(e).then(e=>this._handleErrors(e)).then(e=>e.json())}}}obtemNegociacoesDaSemana(){return this._http.get("negociacoes/semana").then(e=>e.map(e=>new m(new Date(e.data),e.quantidade,e.valor)),e=>{throw new l("Não foi possível obter as negociações da semana")})}obtemNegociacoesDaSemanaAnterior(){return this._http.get("negociacoes/anterior").then(e=>e.map(e=>new m(new Date(e.data),e.quantidade,e.valor)),e=>{throw new l("Não foi possível obter as negociações da semana anterior")})}obtemNegociacoesDaSemanaRetrasada(){return this._http.get("negociacoes/retrasada").then(e=>e.map(e=>new m(new Date(e.data),e.quantidade,e.valor)),e=>{throw new l("Não foi possível obter as negociações da semana retrasada")})}obtemNegociacoesDoPeriodo(){var e=this;return function(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,o){return function n(r,a){try{var i=t[r](a),s=i.value}catch(e){return void o(e)}if(!i.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}("next")}))}}((function*(){try{return(yield Promise.all([e.obtemNegociacoesDaSemana(),e.obtemNegociacoesDaSemanaAnterior(),e.obtemNegociacoesDaSemanaRetrasada()])).reduce((function(e,t){return e.concat(t)}),[]).sort((function(e,t){return t.data.getTime()-e.data.getTime()}))}catch(e){throw console.log(e),new l("Não foi possível obter as negociações do período")}}))()}},this._init()}_init(){var e=this;return T((function*(){try{const t=yield s();(yield t.listaTodos()).forEach((function(t){return e._negociacoes.adiciona(t)}))}catch(t){e._mensagem.texto=p(t)}}))()}adiciona(e){var t=this;return T((function*(){try{const e=t._criaNegociacao(),o=yield s();yield o.adiciona(e),t._negociacoes.adiciona(e),t._mensagem.texto="Negociação adicionada com sucesso",t._limpaFormulario()}catch(e){t._mensagem.texto=p(e)}}))()}_limpaFormulario(){this._inputData.value="",this._inputQuantidade.value=1,this._inputValor.value=0,this._inputData.focus()}_criaNegociacao(){return new m(w.paraData(this._inputData.value),parseInt(this._inputQuantidade.value),parseFloat(this._inputValor.value))}importaNegociacoes(){var e=this;return T((function*(){try{const t=yield e._service.obtemNegociacoesDoPeriodo();console.log(t),t.filter((function(t){return!e._negociacoes.paraArray().some((function(e){return t.equals(e)}))})).forEach((function(t){return e._negociacoes.adiciona(t)})),e._mensagem.texto="Negociações do período importadas com sucesso"}catch(t){e._mensagem.texto=p(t)}}))()}apaga(){var e=this;return T((function*(){try{const t=yield s();yield t.apagaTodos(),e._negociacoes.esvazia(),e._mensagem.texto="Negociações apagadas com sucesso"}catch(t){e._mensagem.texto=p(t)}}))()}}).prototype,"adiciona",[O,D],Object.getOwnPropertyDescriptor(E.prototype,"adiciona"),E.prototype),q(E.prototype,"importaNegociacoes",[N,j],Object.getOwnPropertyDescriptor(E.prototype,"importaNegociacoes"),E.prototype),q(E.prototype,"apaga",[P],Object.getOwnPropertyDescriptor(E.prototype,"apaga"),E.prototype),S=E))||S);const z=new m(new Date,1,200),$=new Headers;$.set("Content-Type","application/json");const A=JSON.stringify(z);fetch("/negociacoes",{method:"POST",headers:$,body:A}).then(()=>console.log("Dado enviado com sucesso"))}]);